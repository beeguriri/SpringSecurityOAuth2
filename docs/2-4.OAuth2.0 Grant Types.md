## OAuth 2.0 Grant Types
- Access Tokenì„ ë°œê¸‰í•¨ìœ¼ë¡œì¨ ê¶Œí•œë¶€ì—¬ë¥¼ í•¨
![](../images/grantTypes.png)

### âœ¨ Authorization Code
```mermaid
sequenceDiagram
    Resource Owner->>Client: ì„œë¹„ìŠ¤ ì ‘ì†
    Client->>+Authorization Server: authorization code ìš”ì²­
    Note over Client,Authorization Server: GET /auth?response_type=code&client_id=[id]&scope=[scope]&redirect_uri=[uri]
    Authorization Server->>Resource Owner: ë¡œê·¸ì¸ í˜ì´ì§€
    Resource Owner->>Authorization Server: ë¡œê·¸ì¸ ì ‘ì†
    Authorization Server->>Resource Owner: ë™ì˜í•˜ê¸°(Consent) í˜ì´ì§€
    Resource Owner->>Authorization Server: ë™ì˜í•˜ê¸°
    Authorization Server-->>-Client: authorization code ì‘ë‹µ ë¦¬ë‹¤ì´ë ‰íŠ¸
    Note over Client,Authorization Server: ...&code=[code]
    Client->>+Authorization Server: Access Tokenìœ¼ë¡œ êµí™˜ ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: code, client_id, client_secret, grant_type, redirect_uri
    Authorization Server-->>-Client: Access Token, Refresh Token ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server->>Authorization Server: Token ê²€ì¦
    Authorization Server->>Resource Server: Token ê²€ì¦ ì‘ë‹µ
    Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
```
- ì„œë²„ ì‚¬ì´ë“œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë§ì´ ì‚¬ìš© í•¨
- ë³´ì•ˆì— ê°€ì¥ ì•ˆì „í•¨
- í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ë¡œë¶€í„° ì½”ë“œë¥¼ ë°›ìŒ (ì‚¬ìš©ìì˜ ìŠ¹ì¸ ë° ë™ì˜)
  ![](../images/grant_types/code_1.png)
  ![](../images/grant_types/response.png)
- í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ì—ê²Œ ì½”ë“œë¥¼ ë³´ë‚¸ í›„
  ![](../images/grant_types/code_2.png)
- ì¸ê°€ì„œë²„ë¡œë¶€í„° Access Tokenì„ ë°œê¸‰ ë°›ìŒ



### âœ¨ Implicit (Deprecated)
```mermaid
sequenceDiagram
    Resource Owner->>Client: ì„œë¹„ìŠ¤ ì ‘ì†
    Client->>+Authorization Server: Access Token ìš”ì²­
    Note over Client,Authorization Server: GET /auth?response_type=token&client_id=[id]&scope=[scope]&redirect_uri=[uri]
    Authorization Server->>Resource Owner: ë¡œê·¸ì¸ í˜ì´ì§€
    Resource Owner->>Authorization Server: ë¡œê·¸ì¸ ì ‘ì†
    Authorization Server->>Resource Owner: ë™ì˜í•˜ê¸°(Consent) í˜ì´ì§€
    Resource Owner->>Authorization Server: ë™ì˜í•˜ê¸°
    Authorization Server-->>-Client: Access Token ì‘ë‹µ
    Note over Client,Authorization Server: /access_token=[token]
    Client->>Authorization Server: Token ê²€ì¦
    Authorization Server->>Client: Token ê²€ì¦ ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
```
- ì£¼ë¡œ ê³µê°œ í´ë¼ì´ì–¸íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ (SPA ê¸°ë°˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì•±)ì—ì„œ ì‚¬ìš©
- tokenì„ ë°”ë¡œ ë°œê¸‰í•´ì£¼ë©° Access Tokenì´ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œ
  ![](../images/grant_types/implicit.png)

### âœ¨ Resource Owner Password Credentials (Deprecated)
```mermaid
sequenceDiagram
    Resource Owner->>Client: ì„œë¹„ìŠ¤ ì ‘ì†
    Client->>+Authorization Server: ì¸ì •ì •ë³´(id/password) í¬í•¨í•˜ì—¬ Access Token ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: username, password, client_id, client_secret, grant_type, dedirect_uri
    Authorization Server-->>-Client: Access Token, Refresh Token ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server->>Authorization Server: Token ê²€ì¦
    Authorization Server->>Resource Server: Token ê²€ì¦ ì‘ë‹µ
    Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
```
- ì‚¬ìš©ìì˜ IDì™€ passwordë¥¼ í†µí•´ ê¶Œí•œ ë¶€ì—¬ë¥¼ ë°›ìŒ
  ![](../images/grant_types/password.png)
- ì‚¬ìš©ìì˜ IDì™€ Passwordê°€ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œ
- í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ì˜ ì‚¬ìš©ì ID, Passwordë¥¼ ì•Œê³ ìˆìŒ
- ë³´í†µ ì‹ ë¢°ì„± ë†’ì€ ìì‚¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©

### âœ¨ Client Credentials
```mermaid
sequenceDiagram
    Client->>+Authorization Server: Access Token ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: client_id, client_secret, grant_type=client_credentials
    Authorization Server-->>-Client: Access Token ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server->>Authorization Server: Token ê²€ì¦
    Authorization Server->>Resource Server: Token ê²€ì¦ ì‘ë‹µ
    Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
```
- í´ë¼ì´ì–¸íŠ¸ì˜ ID, Secretë§Œ ìˆìœ¼ë©´ ì¸ê°€ì„œë²„ë¡œë¶€í„° Token ë°œê¸‰ ë°›ìŒ
  ![](../images/grant_types/client_credentials.png)
- ì‚¬ìš©ìê°€ ì—†ìŒ (ë°±ê·¸ë¼ìš´ë“œì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ë“±)
- ì‚¬ìš©ìì— ëŒ€í•œ ì‘ë‹µì´ ë‹¤ë¥¸ grant typeê³¼ ë‹¤ë¦„ (ì‚¬ìš©ìê°€ ì—†ê¸° ë•Œë¬¸ì—)
  ![](../images/grant_types/client_credentials_response.png)

### âœ¨ Refresh Token
```mermaid
sequenceDiagram
    Client->>+Authorization Server: Access Token ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: client_id, client_secret, refresh_token, grant_type=refresh_token
    Authorization Server-->>-Client: Access Token ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
      Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
      Resource Server->>Authorization Server: Token ê²€ì¦
      Authorization Server->>Resource Server: Token ê²€ì¦ ì‘ë‹µ
      Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server-->>-Client: Token ë§Œë£Œ
    Client->>+Authorization Server: Access Token ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: client_secret, refresh_token, grant_type=refresh_token
    Authorization Server-->>-Client: New Access Token & New Refresh Token ì‘ë‹µ
```
- Authorization Code Typeì—ì„œ ì§€ì›
- Access Token ë§Œë£Œ ì‹œ Refresh Tokenìœ¼ë¡œ Access Tokenì„ ì¬ë°œê¸‰ ë°›ìŒ
  ![](../images/grant_types/refresh_token.png)
- Refresh Tokenì´ ìœ íš¨í•˜ë‹¤ë©´ ì¸ì¦ê³¼ì •ì„ ì²˜ìŒë¶€í„° ë°˜ë³µí•˜ì§€ ì•Šì•„ë„ Access Tokenì„ ì¬ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆìŒ
- í•œë²ˆ ì‚¬ìš©ëœ Refresh Tokenì€ íê¸°ë˜ê±°ë‚˜ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆìŒ
  - ë³´í†µ ë³´ì•ˆìƒ Refresh Token ë„ ìƒˆë¡­ê²Œ ë°œê¸‰ ë°›ìŒ

### âœ¨ PKCE-Enhanced Authorization Code
```mermaid
sequenceDiagram
    Resource Owner->>Client: ì„œë¹„ìŠ¤ ì ‘ì†
    Client->>+Authorization Server: authorization code ìš”ì²­
    Note over Client,Authorization Server: GET /auth?response_type=code&client_id=[id]&scope=[scope]&redirect_uri=[uri]&code_challenge=[]&code_challenge_method=S256
    Authorization Server->>Resource Owner: ë¡œê·¸ì¸ í˜ì´ì§€
    Resource Owner->>Authorization Server: ë¡œê·¸ì¸ ì ‘ì†
    Authorization Server-->>-Client: authorization code ì‘ë‹µ ë¦¬ë‹¤ì´ë ‰íŠ¸
    Note over Client,Authorization Server: ...&code=[code]
    Client->>+Authorization Server: Access Tokenìœ¼ë¡œ êµí™˜ ìš”ì²­
    Note over Client,Authorization Server: POST /token, params: code, client_id, client_secret, grant_type, redirect_uri, code_verifier
    Authorization Server-->>-Client: Access Token, Refresh Token ì‘ë‹µ
    loop Access Token ë§Œë£Œ ì‹œ ê¹Œì§€
    Client->>+Resource Server: Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
    Resource Server->>Authorization Server: Token ê²€ì¦
    Authorization Server->>Resource Server: Token ê²€ì¦ ì‘ë‹µ
    Resource Server-->>-Client: ìš”ì²­ ë°ì´í„° ì‘ë‹µ
    end
```
- Authorization Code Grant Type ì˜ í™•ì¥ ë²„ì „
- ê¶Œí•œë¶€ì—¬ì½”ë“œ ìš”ì²­ ì‹œ Code Verifier ì™€ Code Challengeë¥¼ ì¶”ê°€í•˜ì—¬ Codeê°€ íƒˆì·¨ë‹¹í–ˆì„ ë•Œ Access Tokenì„ ë°œê¸‰í•˜ì§€ ëª»í•˜ë„ë¡ ì°¨ë‹¨
---
#### ğŸ’œ ì½”ë“œ ìƒì„±
- Code Verifier (í•´ì‹œ ë˜ê¸° ì „ ê°’)
  - ê¶Œí•œë¶€ì—¬ì½”ë“œ ìš”ì²­ ì „ì— ì•±ì´ ì›ë˜ ìƒì„±í•œ PKCE ìš”ì²­ì— ëŒ€í•œ ì½”ë“œ ê²€ì¦ê¸°
  - 43 ~ 128 ê¸€ììˆ˜ë¥¼ ê°€ì§„ ë¬´ì‘ìœ„ ë¬¸ìì—´
  - AZaz09-._~ ì˜ ASCII ë¬¸ìë“¤ë¡œë§Œ êµ¬ì„± ë¨
- Code Challenge (í•´ì‹œ + ì¸ì½”ë”© ëœ ê°’)
  - ì„ íƒí•œ Hash ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ Code Verifierë¥¼ Hashing í•œ í›„ Base64 ì¸ì½”ë”© í•œ ê°’
- Code Challenge Method
  - plain : Code Verifierê°€ íŠ¹ì • ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
  - S256 : Code Verifierê°€ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
---
#### ğŸ’œ ì²˜ë¦¬ íë¦„
- Code ë°œê¸‰ ë°›ê¸° ìœ„í•œ ë‹¨ê³„
  ![](../images/grant_types/pkce_1.png)
  - í´ë¼ì´ì–¸íŠ¸ëŠ” code verifier ìƒì„±, Code Challenge Methodë¥¼ ì‚¬ìš©í•˜ì—¬ Code Challenge ê³„ì‚°
  - í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ì— Code Challenge Method, Code Challenge í¬í•¨í•˜ì—¬ ìš”ì²­
  - ì¸ê°€ì„œë²„ê°€ ìœ íš¨ì„± ê²€ì¦
  - ì¸ê°€ì„œë²„ê°€ Code Challenge, Code Challenge Methodì˜ ì¡´ì¬ë¥¼ í™•ì¸
  - ì¸ê°€ì„œë²„ê°€ ê¶Œí•œ codeì— ëŒ€í•´ Code Challenge, Code Challenge Method ì €ì¥
  - ì¸ê°€ì„œë²„ê°€ ê¶Œí•œ code ì‘ë‹µ ë¦¬í„´
- Access Token êµí™˜í•˜ê¸° ìœ„í•œ ë‹¨ê³„
  ![](../images/grant_types/pkce_2.png)
  - í´ë¼ì´ì–¸íŠ¸ê°€ code verifierë¥¼ í¬í•¨í•˜ì—¬ Access token ìš”ì²­
  - ì¸ê°€ì„œë²„ê°€ ìœ íš¨ì„± ê²€ì¦
  - ì¸ê°€ì„œë²„ëŠ” code verifier ì™€ ì €ì¥ëœ Code Challenge Methodë¥¼ ì‚¬ìš©í•˜ì—¬ Code Challenge ê³„ì‚°
  - ì¸ê°€ì„œë²„ëŠ” ê³„ì‚° ëœ Code Challengeì™€ ì´ˆê¸° ìš”ì²­ì—ì„œ ì €ì¥í•œ Code Challenge ë¥¼ ë¹„êµí•˜ì—¬ Access token ë°œê¸‰ì—¬ë¶€ ê²°ì •
- [(ì°¸ê³ ) Code Verifier ìƒì„±í•˜ëŠ” ì‚¬ì´íŠ¸](https://tonyxu-io.github.io/pkce-generator/)

### âœ¨ parameter type
- í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ì—ê²Œ ê¶Œí•œ ë¶€ì—¬ ìš”ì²­ì„ í• ë•Œ ì „ë‹¬í•˜ëŠ” íŒŒë¼ë¯¸í„°
- client_id : í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ ì„œë²„ì— ë“±ë¡ í•  ë•Œ ìƒì„±í•˜ëŠ” í‚¤
- client_secret : Auth serverì— ë“±ë¡ ëœ íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì˜ client_idì— ëŒ€í•œ ë¹„ë°€ê°’
- response_type : code / token / id_token => ì„œë²„ê°€ ì¿¼ë¦¬ ë¬¸ìì—´ì— ë°˜í™˜
- grant_type : authorization_code / password  / client_credentials / refresh_token
- redirect_uri : ì‚¬ìš©ìê°€ ì¸ì¦ì— ì„±ê³µí•˜ë©´, ì¸ê°€ ì„œë²„ê°€ ë¦¬ë‹¤ì´ë ‰ì…˜
- scope : ì ‘ê·¼ ë²”ìœ„ ì§€ì •, profile / email / read / write / ...
- state : CSRF ê³µê²© ë°©ì§€ë¥¼ ìœ„í•´ ì‚¬ìš©, í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ê°€ì„œë²„ì— stateë¥¼ ë³´ë‚´ê³ , ì„œë²„ê°€ ë¦¬ë‹¤ì´ë ‰íŠ¸ í• ë•Œ stateë¥¼ ë°›ì•„ì„œ ë™ì¼í•œ ê°’ì¸ì§€ í™•ì¸